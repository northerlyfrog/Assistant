{"version":3,"sources":["../src/module.js"],"names":["config","appEvents","PanelCtrl","_","moment","InfluxAdminCtrl","$scope","$injector","$q","$rootScope","$timeout","$http","datasourceSrv","get","injector","q","events","on","onInitEditMode","bind","onRender","onPanelInitalized","onRefresh","writing","defaults","mode","query","updateEvery","panel","dbs","forEach","datasources","val","key","type","defaultDatasource","unshift","push","isNil","datasource","length","queryInfo","last","count","queries","updateShowQueries","addEditorTab","editorTabIndex","console","log","writeDataText","error","then","ds","url","urls","database","method","data","headers","rsp","err","status","qinfo","emit","title","text","text2","icon","yesText","onConfirm","_seriesQuery","id","res","db","temp","results","series","values","durr","unit","mag","secs","parseInt","substring","lastId","Date","now","isShowCurrentQueries","timer","onSubmit","click","startsWith","str","split","startTime","runningQuery","queryTime","message","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import config from 'app/core/config';\nimport appEvents from 'app/core/app_events';\n\nimport {PanelCtrl} from  'app/plugins/sdk';\n\nimport _ from 'lodash';\nimport moment from 'moment';\n\n\nclass InfluxAdminCtrl extends PanelCtrl {\n  constructor($scope, $injector, $q, $rootScope, $timeout, $http) {\n    super($scope, $injector);\n    this.datasourceSrv = $injector.get('datasourceSrv');\n    this.injector = $injector;\n    this.q = $q;\n    this.$timeout = $timeout;\n    this.$http = $http;\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('panel-initialized', this.onPanelInitalized.bind(this));\n    this.events.on('refresh', this.onRefresh.bind(this));\n\n    this.writing = false;\n\n    // defaults configs\n    var defaults = {\n      mode: 'current', // 'write', 'query'\n      query: 'SHOW DIAGNOSTICS',\n      updateEvery: 1200\n    };\n    _.defaults(this.panel, defaults);\n\n\n    // All influxdb datasources\n    this.dbs = [];\n    _.forEach(config.datasources, (val, key) => {\n      if (\"influxdb\" == val.type) {\n        if(key == config.defaultDatasource) {\n          this.dbs.unshift(key);\n        }\n        else {\n          this.dbs.push(key);\n        }\n      }\n    });\n\n    // pick a datasource\n    if( _.isNil( this.panel.datasource ) ) {\n      if(this.dbs.length > 0) {\n        this.panel.datasource = this.dbs[0];\n      }\n    }\n\n    this.queryInfo = {\n      last: 0,\n      count: 0,\n      queries: []\n    };\n\n    if(this.panel.updateEvery > 0) {\n      this.updateShowQueries();\n    }\n  }\n\n\n  isShowQueryWindow() {\n    return this.panel.mode == 'query';\n  }\n\n  isShowCurrentQueries() {\n    return this.panel.mode == 'current';\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/natel-influx-admin-panel/editor.html',1);\n    this.addEditorTab('Write Data', 'public/plugins/natel-influx-admin-panel/write.html',2);\n    this.editorTabIndex = 1;\n  }\n\n  writeData() {\n    console.log( \"WRITE\", this.writeDataText );\n    this.writing = true;\n    this.error = null;\n    return this.datasourceSrv.get(this.panel.datasource).then( (ds) => {\n      this.$http({\n        url: ds.urls[0] + '/write?db=' + ds.database,\n        method: 'POST',\n        data: this.writeDataText,\n        headers: {\n          \"Content-Type\": \"plain/text\"\n        }\n      }).then((rsp) => {\n        this.writing = false;\n        console.log( \"OK\", rsp );\n      }, err => {\n        this.writing = false;\n        console.log( \"ERROR\", err );\n        this.error = err.data.error + \" [\"+err.status+\"]\";\n      });\n    });\n  }\n\n  askToKillQuery(qinfo) {\n    appEvents.emit('confirm-modal', {\n      title: 'Kill Influx Query',\n      text: 'Are you sure you want to kill this query?',\n      text2: qinfo.query,\n      icon: 'fa-trash',\n      //confirmText: 'yes',\n      yesText: 'Kill Query',\n      onConfirm: () => {\n        this.datasourceSrv.get(this.panel.datasource).then( (ds) => {\n          ds._seriesQuery( 'kill query '+qinfo.id ).then( (res) => {\n            console.log( 'killed', qinfo, res );\n          });\n        });\n      }\n    });\n    return;\n  }\n\n  updateShowQueries() {\n    this.datasourceSrv.get(this.panel.datasource).then( (ds) => {\n      this.db = ds;\n      ds._seriesQuery( 'SHOW QUERIES' ).then( (data) => {\n        var temp = [];\n        _.forEach(data.results[0].series[0].values, (res) => {\n\n          // convert the time (string) to seconds (so that sort works!)\n          let durr = res[3];\n          let unit = durr[durr.length - 1];\n          let mag = 0;\n          if(unit=='s') {\n            mag = 1;\n          }\n          else if(unit=='m') {\n            mag = 60;\n          }\n          else if(unit=='h') {\n            mag = 60*60;\n          }\n          let secs = parseInt( durr.substring(0,durr.length-1)) * mag;\n          if(secs == 0 && 'SHOW QUERIES' == res[1]) {\n            // Don't include the current query\n            this.queryInfo.lastId = res[0];\n          }\n          else {\n            temp.push( {\n              'secs': secs,\n              'time': res[3],\n              'query': res[1],\n              'db': res[2],\n              'id': res[0]\n            });\n          }\n        });\n\n        this.queryInfo.count++;\n        this.queryInfo.last = Date.now();\n        this.queryInfo.queries = temp;\n\n        // Check if we should refresh the view\n        if( this.isShowCurrentQueries() && this.panel.updateEvery>0 ) {\n          this.queryInfo.timer = this.$timeout( () => {\n            this.updateShowQueries()\n          }, this.panel.updateEvery);\n        }\n      });\n    });\n  }\n\n  configChanged() {\n    this.error = null;\n    if( this.isShowCurrentQueries() ) {\n      this.updateShowQueries();\n    }\n    else {\n      this.onSubmit();\n    }\n  }\n\n  getQueryTemplates() {\n    return [\n      { text: 'Show Databases',  click: \"ctrl.panel.query = 'SHOW DATABASES'\" },\n      { text: 'Create Database', click: \"ctrl.panel.query = 'CREATE DATABASE &quot;db_name&quot;'\" },\n      { text: 'Drop Database',   click: \"ctrl.panel.query = 'DROP DATABASE &quot;db_name&quot;'\" },\n      { text: '--' },\n      { text: 'Show Measurements', click: \"ctrl.panel.query = 'SHOW MEASUREMENTS'\" },\n      { text: 'Show Field Keys',   click: \"ctrl.panel.query = 'SHOW FIELD KEYS FROM &quot;measurement_name&quot;'\" },\n      { text: 'Show Tag Keys',     click: \"ctrl.panel.query = 'SHOW TAG KEYS FROM &quot;measurement_name&quot;'\" },\n      { text: 'Show Tag Values',   click: \"ctrl.panel.query = 'SHOW TAG VALUES FROM &quot;measurement_name&quot; WITH KEY = &quot;tag_key&quot;'\" },\n      { text: 'Drop Measurement',  click: \"ctrl.panel.query = 'DROP MEASUREMENT &quot;measurement_name&quot;'\" },\n      { text: '--' },\n      { text: 'Show Retention Policies', click: \"ctrl.panel.query = 'SHOW RETENTION POLICIES ON &quot;db_name&quot;'\" },\n      { text: 'Create Retention Policy', click: \"ctrl.panel.query = 'CREATE RETENTION POLICY &quot;rp_name&quot; ON &quot;db_name&quot; DURATION 30d REPLICATION 1 DEFAULT'\" },\n      { text: 'Drop Retention Policy',   click: \"ctrl.panel.query = 'DROP RETENTION POLICY &quot;rp_name&quot; ON &quot;db_name&quot;'\" },\n      { text: '--' },\n      { text: 'Show Continuous Queries', click: \"ctrl.panel.query = 'SHOW CONTINUOUS QUERIES'\" },\n      { text: 'Create Continuous Query', click: \"ctrl.panel.query = 'CREATE CONTINUOUS QUERY &quot;cq_name&quot; ON &quot;db_name&quot; BEGIN SELECT min(&quot;field&quot;) INTO &quot;target_measurement&quot; FROM &quot;current_measurement&quot; GROUP BY time(30m) END'\" },\n      { text: 'Drop Continuous Query',   click: \"ctrl.panel.query = 'DROP CONTINUOUS QUERY &quot;cq_name&quot; ON &quot;db_name&quot;'\" },\n      { text: '--' },\n      { text: 'Show Users',        click: \"ctrl.panel.query = 'SHOW USERS'\" },\n  //  { text: 'Create User',       click: \"ctrl.query = 'CREATE USER &quot;username&quot; WITH PASSWORD &apos;password&apos;\" },\n  //  { text: 'Create Admin User', click: \"ctrl.query = 'CREATE USER &quot;username&quot; WITH PASSWORD 'password' WITH ALL PRIVILEGES\" },\n      { text: 'Drop User',         click: \"ctrl.panel.query = 'DROP USER &quot;username&quot;'\" },\n      { text: '--' },\n      { text: 'Show Stats',       click: \"ctrl.panel.query = 'SHOW STATS'\" },\n      { text: 'Show Diagnostics', click: \"ctrl.panel.query = 'SHOW DIAGNOSTICS'\" }\n    ];\n  }\n\n  isClickableQuery() {\n    if( \"SHOW MEASUREMENTS\" == this.panel.query) {\n      return true;\n    }\n    if( this.panel.query.startsWith( 'SHOW FIELD KEYS FROM \"')) {\n      return true;\n    }\n    return false;\n  }\n\n  onClickedResult(res) {\n    if( \"SHOW MEASUREMENTS\" == this.panel.query) {\n      this.panel.query = 'SHOW FIELD KEYS FROM \"' + res[0] +'\"';\n      this.onSubmit();\n    }\n    else if( this.panel.query.startsWith( 'SHOW FIELD KEYS FROM \"')) {\n      var str = this.panel.query.split(/\"/)[1];\n      this.panel.query = 'SELECT \"' + res[0] +'\" FROM \"' + str +'\" ORDER BY time desc LIMIT 10';\n      this.onSubmit();\n    }\n    return;\n  }\n\n  onSubmit() {\n    var startTime = Date.now();\n    this.error = null;\n    this.runningQuery = true;\n    this.datasourceSrv.get(this.panel.datasource).then( (ds) => {\n      //console.log( 'ds', ds, this.query);\n      this.db = ds;\n      ds._seriesQuery( this.panel.query ).then((data) => {\n       // console.log(\"RSP\", this.query, data);\n        this.rsp = data;\n        this.runningQuery = false;\n        this.queryTime = (Date.now() - startTime) / 1000.0;\n      }, (err) => {\n       // console.log( 'ERROR with series query', err );\n        this.runningQuery = false;\n        this.error = err.message;\n        this.queryTime = (Date.now() - startTime) / 1000.0;\n      });\n    });\n  }\n\n  onPanelInitalized() {\n    //console.log(\"onPanelInitalized()\")\n    this.onSubmit();\n  }\n\n  onRender() {\n    //console.log(\"onRender\");\n  }\n\n  onRefresh() {\n    if( this.isShowCurrentQueries() ) {\n      this.updateShowQueries();\n    }\n    //console.log(\"onRefresh\");\n  }\n}\nInfluxAdminCtrl.templateUrl = 'module.html';\n\nexport {\n  InfluxAdminCtrl as PanelCtrl\n};\n\n\n"]}